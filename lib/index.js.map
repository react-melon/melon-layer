{"version":3,"sources":["index.js"],"names":["Component","PropTypes","unstable_renderSubtreeIntoContainer","unmountComponentAtNode","Layer","constructor","args","onClickAway","bind","componentDidMount","renderLayer","componentDidUpdate","componentWillUnmount","unmountLayer","e","target","defaultPrevented","open","props","layer","contains","render","useLayerMask","document","createElement","classNames","addEventListener","push","setTimeout","window","className","join","body","appendChild","layerContent","removeEventListener","removeChild","getLayer","propTypes","func","bool","isRequired","defaultProps"],"mappings":"AAAA;;;;;AAKA,SAAQA,SAAR,EAAmBC,SAAnB,QAAmC,OAAnC;AACA,SACIC,mCADJ,EAEIC,sBAFJ,QAGO,WAHP;;AAKA,eAAe,MAAMC,KAAN,SAAoBJ,SAApB,CAA8B;;AAEzCK,gBAAY,GAAGC,IAAf,EAAqB;AACjB,cAAM,GAAGA,IAAT;AACA,aAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAnB;AACH;;AAEDC,wBAAoB;AAChB,aAAKC,WAAL;AACH;;AAEDC,yBAAqB;AACjB,aAAKD,WAAL;AACH;;AAEDE,2BAAuB;AACnB,aAAKC,YAAL;AACH;;AAEDN,gBAAYO,CAAZ,EAAe;;AAEX,YAAI,EAACC,MAAD,EAASC,gBAAT,KAA6BF,CAAjC;AACA,YAAI,EAACP,WAAD,EAAcU,IAAd,KAAsB,KAAKC,KAA/B;AACA,YAAIC,QAAQ,KAAKA,KAAjB;;AAEA,YAAIH,oBAAoB,CAACC,IAArB,IAA6B,CAACE,KAAlC,EAAyC;AACrC;AACH;;AAED,YAAIJ,WAAWI,KAAX,IAAoB,CAACA,MAAMC,QAAN,CAAeL,MAAf,CAAzB,EAAiD;AAC7CR,2BAAeA,aAAf;AACH;AAEJ;;AAEDG,kBAAc;;AAEV,YAAI,EAACO,IAAD,EAAOI,MAAP,EAAeC,YAAf,KAA+B,KAAKJ,KAAxC;;AAEA,YAAI,CAACD,IAAL,EAAW;AACP,iBAAKJ,YAAL;AACA;AACH;;AAED,YAAIM,QAAQ,KAAKA,KAAjB;;AAEA,YAAI,CAACA,KAAL,EAAY;;AAERA,oBAAQ,KAAKA,KAAL,GAAaI,SAASC,aAAT,CAAuB,KAAvB,CAArB;AACA,gBAAIC,aAAa,CAAC,UAAD,CAAjB;;AAEA;AACA,gBAAIH,YAAJ,EAAkB;AACdH,sBAAMO,gBAAN,CAAuB,OAAvB,EAAgC,KAAKnB,WAArC;AACAkB,2BAAWE,IAAX,CAAgB,cAAhB;AACH;AACD;AAJA,iBAKK;;AAED;AACA;AACA;AACAC,+BAAW,MAAM;AACbC,+BAAOH,gBAAP,CAAwB,OAAxB,EAAiC,KAAKnB,WAAtC;AACH,qBAFD,EAEG,CAFH;AAGH;;AAEDY,kBAAMW,SAAN,GAAkBL,WAAWM,IAAX,CAAgB,GAAhB,CAAlB;;AAEAR,qBAASS,IAAT,CAAcC,WAAd,CAA0Bd,KAA1B;AACH;;AAED,aAAKe,YAAL,GAAoBhC,oCAChB,IADgB,EAEhBmB,QAFgB,EAGhBF,KAHgB,CAApB;AAMH;;AAEDN,mBAAe;;AAEX,YAAIM,QAAQ,KAAKA,KAAjB;;AAEA,YAAI,CAACA,KAAL,EAAY;AACR;AACH;;AAEDA,cAAMgB,mBAAN,CAA0B,OAA1B,EAAmC,KAAK5B,WAAxC;AACAsB,eAAOM,mBAAP,CAA2B,OAA3B,EAAoC,KAAK5B,WAAzC;;AAEAJ,+BAAuBgB,KAAvB;AACAI,iBAASS,IAAT,CAAcI,WAAd,CAA0BjB,KAA1B;AACA,aAAKA,KAAL,GAAa,IAAb;AAEH;;AAEDkB,eAAW;AACP,eAAO,KAAKlB,KAAZ;AACH;;AAEDE,aAAS;AACL,eAAO,IAAP;AACH;;AAvGwC;;AA2G7CjB,MAAMkC,SAAN,GAAkB;AACd/B,iBAAaN,UAAUsC,IADT;AAEdtB,UAAMhB,UAAUuC,IAAV,CAAeC,UAFP;AAGdpB,YAAQpB,UAAUsC,IAAV,CAAeE,UAHT;AAIdnB,kBAAcrB,UAAUuC,IAAV,CAAeC;AAJf,CAAlB;;AAOArC,MAAMsC,YAAN,GAAqB;AACjBzB,UAAM,KADW;AAEjBK,kBAAc;AAFG,CAArB","file":"index.js","sourcesContent":["/**\n * @file Layer\n * @author leon <ludafa@outlook.com>\n */\n\nimport {Component, PropTypes} from 'react';\nimport {\n    unstable_renderSubtreeIntoContainer,\n    unmountComponentAtNode\n} from 'react-dom';\n\nexport default class Layer extends Component {\n\n    constructor(...args) {\n        super(...args);\n        this.onClickAway = this.onClickAway.bind(this);\n    }\n\n    componentDidMount() {\n        this.renderLayer();\n    }\n\n    componentDidUpdate() {\n        this.renderLayer();\n    }\n\n    componentWillUnmount() {\n        this.unmountLayer();\n    }\n\n    onClickAway(e) {\n\n        let {target, defaultPrevented} = e;\n        let {onClickAway, open} = this.props;\n        let layer = this.layer;\n\n        if (defaultPrevented || !open || !layer) {\n            return;\n        }\n\n        if (target === layer || !layer.contains(target)) {\n            onClickAway && onClickAway();\n        }\n\n    }\n\n    renderLayer() {\n\n        let {open, render, useLayerMask} = this.props;\n\n        if (!open) {\n            this.unmountLayer();\n            return;\n        }\n\n        let layer = this.layer;\n\n        if (!layer) {\n\n            layer = this.layer = document.createElement('div');\n            let classNames = ['ui-layer'];\n\n            // 如果使用一个 div 作为遮罩，那么这里给 div 加 click 绑定\n            if (useLayerMask) {\n                layer.addEventListener('click', this.onClickAway);\n                classNames.push('variant-mask');\n            }\n            // 否则我们给 window 加事件绑定\n            else {\n\n                // 这么干是因为 Layer 通常是被 click 触发展现的\n                // 事件会继续冒泡到 window 上，这样我们这里就会被直接关闭掉\n                // 所以，这里用 setTimeout 做事件绑定\n                setTimeout(() => {\n                    window.addEventListener('click', this.onClickAway);\n                }, 0);\n            }\n\n            layer.className = classNames.join(' ');\n\n            document.body.appendChild(layer);\n        }\n\n        this.layerContent = unstable_renderSubtreeIntoContainer(\n            this,\n            render(),\n            layer\n        );\n\n    }\n\n    unmountLayer() {\n\n        let layer = this.layer;\n\n        if (!layer) {\n            return;\n        }\n\n        layer.removeEventListener('click', this.onClickAway);\n        window.removeEventListener('click', this.onClickAway);\n\n        unmountComponentAtNode(layer);\n        document.body.removeChild(layer);\n        this.layer = null;\n\n    }\n\n    getLayer() {\n        return this.layer;\n    }\n\n    render() {\n        return null;\n    }\n\n}\n\nLayer.propTypes = {\n    onClickAway: PropTypes.func,\n    open: PropTypes.bool.isRequired,\n    render: PropTypes.func.isRequired,\n    useLayerMask: PropTypes.bool.isRequired\n};\n\nLayer.defaultProps = {\n    open: false,\n    useLayerMask: true\n};\n"]}